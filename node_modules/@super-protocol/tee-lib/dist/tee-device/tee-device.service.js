"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.TeeDeviceService = void 0;
const fs_1 = require("fs");
const p_queue_1 = __importDefault(require("p-queue"));
const addons_tee_1 = require("@super-protocol/addons-tee");
const tlb_1 = require("../tlb");
const errors_1 = require("./errors");
const skip_validation_quote_error_1 = require("./skip-validation-quote-error");
const calculate_hash_1 = require("../helpers/calculate-hash");
class TeeDeviceService {
    constructor(params) {
        this.logger = params?.logger?.child({ name: TeeDeviceService.name });
        this.deviceDebug = Boolean(params.deviceDebug);
        this.dcapVerifyService = new addons_tee_1.SgxNative.DcapQuoteVerifyService();
        this.enclaveService = new addons_tee_1.SgxNative.EnclaveService(params.tmpFolder);
        this.skipQuoteVerifyError = (0, skip_validation_quote_error_1.createQuoteVerifyErrorSkipper)(this.logger);
    }
    async parseAndValidateTlsCertificate(cert) {
        const logger = this.logger?.child({
            method: 'parseAndValidateTlsCertificate',
        });
        logger?.trace('Extract quote from certificate');
        // extract and test of matching between cert (pub key) and quote in cert
        const quote = await this.dcapVerifyService.extractQuoteFromCert(cert);
        logger?.trace({ quoteLength: quote.length }, 'Validate quote');
        // validate quote inside enclave
        await this.skipQuoteVerifyError(this.dcapVerifyService.validateQuoteVerifierEnclave(quote));
        logger?.trace('Parse quote');
        const parser = new tlb_1.TeeSgxParserV3();
        const data = parser.parseQuote(quote);
        logger?.trace({ version: data.header.version }, 'Parse report in quote');
        const report = parser.parseReport(data.report);
        logger?.trace({
            attestationKeyType: data.header.attestationKeyType,
            cpuSvn: report.cpuSvn,
            mrEnclave: Buffer.from(report.mrEnclave).toString('hex'),
            mrSigner: Buffer.from(report.mrSigner).toString('hex'),
        }, 'Return result');
        return {
            userData: Buffer.from(data.header.userData),
            mrEnclave: Buffer.from(report.mrEnclave),
            mrSigner: Buffer.from(report.mrSigner),
            dataHash: Buffer.from(report.dataHash),
        };
    }
    async getUniqKey(salt, policy) {
        const logger = this.logger?.child({ method: 'getSharedUniqKey' });
        if (!TeeDeviceService.cachedHardwareKeys.has(policy)) {
            await this.validateMode();
            if (this.deviceDebug) {
                logger?.warn('ATTENTION: Crypto Debug is enabled! Using insecure static key!');
                TeeDeviceService.cachedHardwareKeys.set(policy, Buffer.alloc(32, 'S'));
            }
            else {
                logger?.trace('Generate');
                await TeeDeviceService.executeLikeWithMutex.add(async () => {
                    const key = await this.enclaveService.getSecretKey({
                        type: addons_tee_1.SgxNative.KeyType.SGX_KEYSELECT_SEAL,
                        policy,
                    });
                    TeeDeviceService.cachedHardwareKeys.set(policy, key);
                });
            }
        }
        else {
            logger?.trace('Got from cache');
        }
        logger?.trace('Derive key');
        const result = (0, calculate_hash_1.calculateHash)(Buffer.concat([TeeDeviceService.cachedHardwareKeys.get(policy), salt]), 'sha256');
        logger?.trace('Return result');
        return result;
    }
    async getDeviceId() {
        const logger = this.logger?.child({ method: 'getDeviceId' });
        if (TeeDeviceService.cacheDeviceId) {
            logger?.trace({ result: TeeDeviceService.cacheDeviceId.toString('hex') }, 'Return result from cached value');
            return TeeDeviceService.cacheDeviceId;
        }
        await this.validateMode();
        let cpuSvnBytes = Buffer.alloc(0);
        let uniqDeviceID = Buffer.alloc(0);
        await TeeDeviceService.executeLikeWithMutex.add(async () => {
            logger?.trace('Write to user_report_data');
            await fs_1.promises.writeFile('/dev/attestation/user_report_data', Buffer.alloc(16));
            logger?.trace('Read from report');
            const report = await fs_1.promises.readFile('/dev/attestation/report');
            const parser = new tlb_1.TeeSgxParserV3();
            const { cpuSvn } = parser.parseReport(report);
            cpuSvnBytes = Buffer.from(cpuSvn, 'hex');
            let sealKey = Buffer.alloc(0);
            sealKey = await this.enclaveService.getSecretKey({
                type: addons_tee_1.SgxNative.KeyType.SGX_KEYSELECT_SEAL,
                policy: 0,
            });
            uniqDeviceID = (0, calculate_hash_1.calculateHash)(Buffer.concat([sealKey, cpuSvnBytes]), 'sha256');
            TeeDeviceService.cacheDeviceId = uniqDeviceID;
        });
        logger?.trace({ result: uniqDeviceID.toString('hex') }, 'Return result');
        return uniqDeviceID;
    }
    async getDataOf(userData) {
        const logger = this.logger?.child({ method: 'getDataOf' });
        await this.validateMode();
        let result = Buffer.alloc(0);
        await TeeDeviceService.executeLikeWithMutex.add(async () => {
            if (!TeeDeviceService.cacheTargetInfo) {
                logger?.trace('Read from my_target_info');
                TeeDeviceService.cacheTargetInfo = await fs_1.promises.readFile('/dev/attestation/my_target_info');
            }
            else {
                logger?.trace('Skip target_info reading, get cached value');
            }
            logger?.trace('Write to target_info');
            await fs_1.promises.writeFile('/dev/attestation/target_info', TeeDeviceService.cacheTargetInfo);
            logger?.trace('Write to user_report_data');
            await fs_1.promises.writeFile('/dev/attestation/user_report_data', Buffer.concat([userData, Buffer.alloc(64)]).slice(0, 64));
            logger?.trace('Read from quote');
            result = await fs_1.promises.readFile('/dev/attestation/quote');
        });
        logger?.trace('Return result');
        return result;
    }
    async validateMode() {
        if (TeeDeviceService.isInGramineMode) {
            return;
        }
        const logger = this.logger?.child({ method: 'validateMode' });
        logger?.trace('Check gramine device');
        try {
            await TeeDeviceService.executeLikeWithMutex.add(async () => {
                await fs_1.promises.access('/dev/attestation/report');
                logger?.trace('Ok');
                TeeDeviceService.isInGramineMode = true;
            });
        }
        catch (error) {
            throw new errors_1.TeeDeviceValidationError(error, 'invalid running mode, is it run in gramine / gramine?');
        }
    }
}
exports.TeeDeviceService = TeeDeviceService;
TeeDeviceService.isInGramineMode = false;
TeeDeviceService.cachedHardwareKeys = new Map();
TeeDeviceService.executeLikeWithMutex = new p_queue_1.default({ concurrency: 1 });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVlLWRldmljZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3RlZS1kZXZpY2UvdGVlLWRldmljZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDJCQUE4QjtBQUM5QixzREFBNEI7QUFFNUIsMkRBQXVEO0FBR3ZELGdDQUF3QztBQU94QyxxQ0FBb0Q7QUFDcEQsK0VBR3VDO0FBQ3ZDLDhEQUEwRDtBQUcxRCxNQUFhLGdCQUFnQjtJQWEzQixZQUFZLE1BQThCO1FBQ3hDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxFQUFFLE1BQU0sRUFBRSxLQUFLLENBQUMsRUFBRSxJQUFJLEVBQUUsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUNyRSxJQUFJLENBQUMsV0FBVyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDL0MsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksc0JBQVMsQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO1FBQ2hFLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxzQkFBUyxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDckUsSUFBSSxDQUFDLG9CQUFvQixHQUFHLElBQUEsMkRBQTZCLEVBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3pFLENBQUM7SUFFRCxLQUFLLENBQUMsOEJBQThCLENBQUMsSUFBWTtRQUMvQyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQztZQUNoQyxNQUFNLEVBQUUsZ0NBQWdDO1NBQ3pDLENBQUMsQ0FBQztRQUVILE1BQU0sRUFBRSxLQUFLLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztRQUVoRCx3RUFBd0U7UUFDeEUsTUFBTSxLQUFLLEdBQUcsTUFBTSxJQUFJLENBQUMsaUJBQWlCLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFD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